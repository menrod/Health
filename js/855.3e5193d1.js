"use strict";(globalThis["webpackChunkmyhealth"]=globalThis["webpackChunkmyhealth"]||[]).push([[855],{1009:(e,a,l)=>{l.d(a,{s:()=>o});var t=l(705);const o=(0,t.nY)("userAuth",{state:()=>({user:{id:"",role:"",patients:[]}}),getters:{getData:e=>e.user},actions:{logout(){localStorage.clear()},setData(e){this.$state.user={id:e.id??"",role:e.role??"",patients:e.patients??[]}},loadData(){return localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")||"{}"):{}}}})},2855:(e,a,l)=>{l.r(a),l.d(a,{default:()=>x});var t=l(1347),o=l(4187),s=l(3031),r=l(144),i=l(9667),u=l(1009),n=l(455);const d=(0,t.pM)({__name:"loginPage",setup(e){const a=(0,n.rd)(),l=(0,u.s)(),d=(0,o.KR)({email:"",password:""}),m=(0,o.KR)({id:"",role:"",patients:[]}),p=((0,o.KR)(),(0,o.KR)({email:"",password:"",role:"",patients:[],first_name:"",last_name:"",middle_name:"",contact_no:"",birth_date:"",gender:"",allergies:""})),c=["Doctor","Patient","PatientWatcher"],v=(0,o.KR)(!1),g=(0,o.KR)(!1);async function b(){r.A.create({spinner:i.A,message:"Working...",position:"top",timeout:1e3});const{data:e,error:a}=await s.supabase.auth.signUp({email:p.value.email,password:p.value.password});if(a||!e.user)r.A.create({color:"negative",message:"Danger Theres a problem during registration",position:"top"});else{if("Patient"===p.value.role){const{error:a}=await s.supabase.from("Profile").insert({id:e.user.id,first_name:p.value.first_name,last_name:p.value.last_name,middle_name:p.value.middle_name,contact_no:p.value.contact_no,birth_date:p.value.birth_date,gender:p.value.gender,allergies:p.value.allergies});a&&r.A.create({color:"negative",message:"Danger can't add profile",position:"top"})}const a=`${p.value.first_name}, ${p.value.last_name} ${p.value.middle_name}`,{error:l}=await s.supabase.from("Roles").insert({id:e.user.id,role:p.value.role,full_name:a,patients:p.value.patients});l?r.A.create({color:"negative",message:"Danger can't add role",position:"top"}):r.A.create({color:"positive",message:"Successfully registered",position:"top"})}}const f=async()=>{r.A.create({spinner:i.A,message:"Working...",position:"top",timeout:1e3});const{data:e,error:t}=await s.supabase.auth.signInWithPassword({email:d.value.email,password:d.value.password});if(console.log(e),t)r.A.create({color:"negative",message:"Danger Theres a problem during login",position:"top"});else{m.value.id=e.user.id;const t=await _(e.user.id);m.value.role=t.role,m.value.patients=t.patients,console.log("User Details",m.value),l.setData(m.value),await a.push("/Profile")}};async function _(e){const{data:a,error:l}=await s.supabase.from("Roles").select("*").eq("id",e);if(!l)return a[0];console.log("Role",l)}return(e,a)=>{const l=(0,t.g2)("q-input"),o=(0,t.g2)("q-icon"),s=(0,t.g2)("q-btn"),r=(0,t.g2)("q-form"),i=(0,t.g2)("q-card-section"),u=(0,t.g2)("q-select"),n=(0,t.g2)("q-card-actions"),m=(0,t.g2)("q-card"),_=(0,t.g2)("q-dialog"),V=(0,t.g2)("q-page"),y=(0,t.g2)("q-page-container"),h=(0,t.g2)("q-layout"),w=(0,t.gN)("close-popup");return(0,t.uX)(),(0,t.Wv)(h,{view:"lHh Lpr fff"},{default:(0,t.k6)(()=>[(0,t.bF)(y,null,{default:(0,t.k6)(()=>[(0,t.bF)(V,{class:"flex flex-center bg-grey-2"},{default:(0,t.k6)(()=>[(0,t.bF)(m,{class:"q-pa-lg shadow-2",style:{"min-width":"350px"}},{default:(0,t.k6)(()=>[(0,t.bF)(i,null,{default:(0,t.k6)(()=>[(0,t.bF)(r,{onSubmit:f},{default:(0,t.k6)(()=>[(0,t.bF)(l,{modelValue:d.value.email,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value.email=e),label:"Email",filled:"",class:"q-mb-md",rules:[e=>!!e||"Email is required"]},null,8,["modelValue","rules"]),(0,t.bF)(l,{modelValue:d.value.password,"onUpdate:modelValue":a[2]||(a[2]=e=>d.value.password=e),label:"Password",type:v.value?"text":"password",filled:"",class:"q-mb-md",rules:[e=>!!e||"Password is required"]},{append:(0,t.k6)(()=>[(0,t.bF)(o,{name:v.value?"visibility":"visibility_off",onClick:a[1]||(a[1]=e=>v.value=!v.value),class:"cursor-pointer"},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),(0,t.bF)(s,{label:"Sign In",type:"submit",color:"primary",class:"full-width q-mt-md"}),(0,t.bF)(s,{label:"Sign Up",color:"secondary",class:"full-width q-mt-md",onClick:a[3]||(a[3]=e=>g.value=!0)})]),_:1})]),_:1}),(0,t.bF)(_,{modelValue:g.value,"onUpdate:modelValue":a[16]||(a[16]=e=>g.value=e),persistent:""},{default:(0,t.k6)(()=>[(0,t.bF)(m,{style:{"min-width":"450px"}},{default:(0,t.k6)(()=>[(0,t.bF)(i,{class:"text-dark"},{default:(0,t.k6)(()=>a[17]||(a[17]=[(0,t.Lk)("div",{class:"text-h6"},"Register New User",-1)])),_:1,__:[17]}),(0,t.bF)(i,{class:"text-dark scroll",style:{"max-height":"400px","overflow-y":"auto"}},{default:(0,t.k6)(()=>[(0,t.bF)(u,{modelValue:p.value.role,"onUpdate:modelValue":a[4]||(a[4]=e=>p.value.role=e),options:c,label:"Role",bordered:""},null,8,["modelValue"]),(0,t.bF)(l,{modelValue:p.value.email,"onUpdate:modelValue":a[5]||(a[5]=e=>p.value.email=e),type:"text",label:"Email",bordered:""},null,8,["modelValue"]),(0,t.bF)(l,{modelValue:p.value.password,"onUpdate:modelValue":a[7]||(a[7]=e=>p.value.password=e),label:"Password",bordered:"",type:v.value?"text":"password"},{append:(0,t.k6)(()=>[(0,t.bF)(o,{name:v.value?"visibility":"visibility_off",onClick:a[6]||(a[6]=e=>v.value=!v.value),class:"cursor-pointer"},null,8,["name"])]),_:1},8,["modelValue","type"]),(0,t.bF)(l,{modelValue:p.value.first_name,"onUpdate:modelValue":a[8]||(a[8]=e=>p.value.first_name=e),type:"text",label:"First Name",bordered:""},null,8,["modelValue"]),(0,t.bF)(l,{modelValue:p.value.last_name,"onUpdate:modelValue":a[9]||(a[9]=e=>p.value.last_name=e),type:"text",label:"Last Name",bordered:""},null,8,["modelValue"]),(0,t.bF)(l,{modelValue:p.value.middle_name,"onUpdate:modelValue":a[10]||(a[10]=e=>p.value.middle_name=e),type:"text",label:"Middle Name",bordered:""},null,8,["modelValue"]),"Patient"===p.value.role?((0,t.uX)(),(0,t.Wv)(l,{key:0,modelValue:p.value.contact_no,"onUpdate:modelValue":a[11]||(a[11]=e=>p.value.contact_no=e),type:"text",label:"Contact No",bordered:""},null,8,["modelValue"])):(0,t.Q3)("",!0),"Patient"===p.value.role?((0,t.uX)(),(0,t.Wv)(l,{key:1,modelValue:p.value.birth_date,"onUpdate:modelValue":a[12]||(a[12]=e=>p.value.birth_date=e),type:"text",label:"Birth Date",bordered:""},null,8,["modelValue"])):(0,t.Q3)("",!0),"Patient"===p.value.role?((0,t.uX)(),(0,t.Wv)(u,{key:2,modelValue:p.value.gender,"onUpdate:modelValue":a[13]||(a[13]=e=>p.value.gender=e),options:["Male","Female"],label:"Gender",bordered:""},null,8,["modelValue"])):(0,t.Q3)("",!0),"Patient"===p.value.role?((0,t.uX)(),(0,t.Wv)(l,{key:3,modelValue:p.value.allergies,"onUpdate:modelValue":a[14]||(a[14]=e=>p.value.allergies=e),type:"text",label:"Allergies(Separate with commas)",bordered:""},null,8,["modelValue"])):(0,t.Q3)("",!0),(0,t.Q3)("",!0)]),_:1}),(0,t.bF)(n,{align:"right"},{default:(0,t.k6)(()=>[(0,t.bo)((0,t.bF)(s,{flat:"",label:"Close",color:"primary"},null,512),[[w]]),(0,t.bF)(s,{flat:"",label:"Register",color:"primary",onClick:b})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})}}});var m=l(6148),p=l(970),c=l(5013),v=l(3341),g=l(222),b=l(3417),f=l(6067),_=l(3933),V=l(9039),y=l(45),h=l(5484),w=l(5034),k=l(8657),F=l(272),A=l.n(F);const q=d,x=q;A()(d,"components",{QLayout:m.A,QPageContainer:p.A,QPage:c.A,QCard:v.A,QCardSection:g.A,QForm:b.A,QInput:f.A,QIcon:_.A,QBtn:V.A,QDialog:y.A,QSelect:h.A,QCardActions:w.A}),A()(d,"directives",{ClosePopup:k.A})}}]);